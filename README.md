# wag
sWAGger - Web API Generator

## Usage
### Generating Code
Create a swagger.yml file with your [service definition](http://editor.swagger.io/#/). Note that WAG does not support the complete swagger spec ([see below](https://github.com/Clever/wag#swagger-spec)). Then generate your code:
```
make swagger
```

This generates three directories. You should not have to modify any of the generated code:
- generated/models: contains all the definitions in your Swagger file as well as API input / output definitions
- generated/server: contains the router, middleware, and handler logic
- generated/clients: contains the Go client library

### Using the Go Server
To use the generated code you need to do two things:
- Implement the controller interface defined in `generated/server/interface.go`
- Use that in your main to get your own handler. For example, something like
```
router := server.SetupServer(mux.NewRouter(), controller)
server := &http.Server{
  Addr:    fmt.Sprintf(":8080"),
  Handler: router,
}
log.Fatal(server.ListenAndServe())
```

See https://github.com/Clever/wag/blob/master/impl/main.go for a working example.

### Using the Go Client
Initialize the client with `New`
```
c := client.New("localhost:8000")
```

Make an API call
```
output, err := c.GetBookByID(ctx, GetBookByIDInput{ID: 1234})
if err != nil {
  // Do something with the error
}
book, ok := output.(models.GetBookByID200Output)
if !ok {
  // The only success value this returns is a 200, so anything else would be an expected error 
}
```

If you're using the client from another WAG-ified service you should pass in the `ctx` object you get in your server handler. Otherwise you can use `context.Background()`

### Using the Node Client
TODO


## Tests
```
make test
```

## Future Features

These are the features we're planning on building in the near future:
- Stricter input validation
  - Support for the required field in the Swagger spec
  - At least some of the validation defined in http://swagger.io/specification/#parameterIn. In particular we want to be able to support checking whether an input parameter is a valid object ID.
- More robust server defaults
  - SIGTERM handling
- Better logging, monitoring, and metrics
  - Logger from the Context
  - Expose pprof port by default
  - Automatically log process metrics (https://github.com/Clever/go-process-metrics)
- More server middleware
  - Panic recovery / handling (don't crash the server every time you get a panic)
- More client resiliency best practices
  - Smarter retry logic
  - Timeouts


## Swagger Spec

Currently, WAG doesn't implement the entire Swagger Spec. This is a non-exhaustive list of the parts of the Swagger specification that haven't been implemented yet.

All Mime Types

Patterned Fields (these are vendor specific extensions anyway)

Multi-File Swagger Definitions

Schema:
- host
- tags
- scheme (just http)
- consumes
- produces
- securityDefinitions
- security

Consumes:
- produces
- consumes
- schemes
- security

Form parameter type
Parameter:
- type (array or file)
- collectionFormat
- possibly the json schema requirements? (uniqueItems, multipleOf, etc...)

Schema object (all these have to be defined in /definitions and are generated by go-swagger)

Discriminators

XML Modeling

Security Objects

Response:
  - Headers
